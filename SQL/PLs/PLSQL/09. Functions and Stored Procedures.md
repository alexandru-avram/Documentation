# Functions and Stored Procedures

PL/SQL allows you to encapsulate logic into named blocks called:
- ✅ Functions – return a value
- ✅ Procedures – perform an action (but don’t return a value directly)

These are stored in the database and can be:
- Reused across applications or by other blocks
- Called from SQL or PL/SQL code
- Secured, optimized, and modularized

Both are called stored program units as they are stored in the database.

## Functions

A function is a PL/SQL block that:
- Returns a single value
- Can be used inside SQL statements
- Accepts parameters (`IN` only)
- Must contain at least one `RETURN` statement


```
CREATE [OR REPLACE] FUNCTION function_name (
  param1 [IN] datatype,
  param2 [IN] datatype
) RETURN return_datatype
IS
  -- Declarations
BEGIN
  -- Logic
  RETURN value;
END;
```

Example: Simple Tax Calculation
```
CREATE OR REPLACE FUNCTION calculate_tax (
  p_salary IN NUMBER
) RETURN NUMBER
IS
  v_tax NUMBER;
BEGIN
  v_tax := p_salary * 0.1;
  RETURN v_tax;
END;
```

### RETURN Statement
The `RETURN` keyword in a function is used to send back a single value to the calling program.

Every function must have at least one `RETURN` statement. The data type of the return value is declared in the function header.

```
CREATE OR REPLACE FUNCTION square (
  p_number IN NUMBER
) RETURN NUMBER
IS
BEGIN
  RETURN p_number * p_number;
END;
```

You cannot use `RETURN` in a procedure to return a value — you use `OUT` parameters instead.

### How to Call a Function
Only functions can be called from SQL statements — not procedures.

#### Inside a block:
```
DECLARE
  v_result NUMBER;
BEGIN
  v_result := calculate_tax(5000);
  DBMS_OUTPUT.PUT_LINE('Tax = ' || v_result);
END;
```

#### In a SQL SELECT:
```
SELECT name, calculate_tax(salary) AS tax
FROM employees;
```

## Procedures
A procedure is a PL/SQL block that:
- Performs an action (like updating data)
- May return values through `OUT` parameters
- Cannot be used directly in a SQL statement
- Can have `IN`, `OUT`, `IN OUT` parameters

```
CREATE [OR REPLACE] PROCEDURE procedure_name (
  param1 IN datatype,
  param2 OUT datatype
)
IS
  -- Declarations
BEGIN
  -- Logic
END;
```

Example: Output Employee Name by ID
```
CREATE OR REPLACE PROCEDURE get_employee_name (
  p_id     IN  NUMBER,
  p_name   OUT VARCHAR2
)
IS
BEGIN
  SELECT name INTO p_name FROM employees WHERE id = p_id;
END;
```

### Parameter Modes - IN, OUT, IN OUT

| Mode     | Direction          | Use Case                 | Can Be Read? | Can Be Written? |
| -------- | ------------------ | ------------------------ | ------------ | --------------- |
| `IN`     | Caller → Procedure | Input only               | ✅            | ❌               |
| `OUT`    | Procedure → Caller | Output only              | ❌            | ✅               |
| `IN OUT` | Caller ↔ Procedure | Read, modify, and return | ✅            | ✅               |


#### IN (default)
- Used to pass a value into a procedure or function
- Acts like a read-only input
- Cannot be modified inside the procedure

```
PROCEDURE greet(p_name IN VARCHAR2) IS
BEGIN
  DBMS_OUTPUT.PUT_LINE('Hello, ' || p_name);
END;
```

#### OUT
- Used to return a value back to the caller
- Acts like an output-only variable
- The variable must be assigned inside the procedure

```
PROCEDURE double_value(p_input IN NUMBER, p_result OUT NUMBER) IS
BEGIN
  p_result := p_input * 2;
END;

----------- CALL

DECLARE
  v_output NUMBER;
BEGIN
  double_value(10, v_output);
  DBMS_OUTPUT.PUT_LINE('Double = ' || v_output);  -- Output: 20
END;
```

#### IN OUT
- Acts as both input and output
- The caller passes a value in, and the procedure can modify it

```
PROCEDURE increase_salary(p_salary IN OUT NUMBER) IS
BEGIN
  p_salary := p_salary + 1000;
END;

----------- CALL

DECLARE
  v_sal NUMBER := 4000;
BEGIN
  increase_salary(v_sal);
  DBMS_OUTPUT.PUT_LINE('New salary = ' || v_sal);  -- Output: 5000
END;
```

### How to Call a Procedure
Procedures are used for:
- Updates/deletes
- Business processes
- Reporting logic
- Chained execution of tasks

```
DECLARE
  v_name VARCHAR2(100);
BEGIN
  get_employee_name(101, v_name);
  DBMS_OUTPUT.PUT_LINE('Employee Name: ' || v_name);
END;
```

## Comparison: Functions vs Procedures

| Feature             | **Function**                                    | **Procedure**                          |
| ------------------- | ----------------------------------------------- | -------------------------------------- |
| Returns value       | ✅ Always returns 1 value (via `RETURN`)         | ❌ No return value (can use OUT params) |
| Call from SQL       | ✅ Yes                                           | ❌ No                                   |
| Use in SELECT/WHERE | ✅ Yes                                           | ❌ No                                   |
| Parameters          | Only IN                                         | IN, OUT, IN OUT                        |
| Primary use         | Calculations, conversions, lookups              | Actions, processes, data manipulation  |
| `RETURN` required?  | ✅ Yes                                           | ❌ No                                   |
| COMMIT allowed?     | ❌ Not recommended in functions                  | ✅ Yes                                  |
| Performance         | Slightly better in SQL (indexed, deterministic) | Slightly more overhead but flexible    |

## Real-World Use Cases

| Task                            | Use...    |
| ------------------------------- | --------- |
| Compute discounts or taxes      | Function  |
| Update rows or send email       | Procedure |
| Validate input (return BOOLEAN) | Function  |
| Export data to a log table      | Procedure |
| Fetch next sequence number      | Function  |
| Chain ETL steps or reports      | Procedure |


## Overloading
Overloading means creating multiple subprograms with the same name but different parameter lists (in number, type, or order). **It lets you reuse a name for different use cases** — just like method overloading in Java, Python, or C++.

| Criteria                                      | Valid Overload?              |
| --------------------------------------------- | ---------------------------- |
| Different number of parameters                | ✅ Yes                        |
| Different parameter data types                | ✅ Yes                        |
| Different parameter modes (`IN`, `OUT`, etc.) | ✅ Yes                        |
| Only different return types (same parameters) | ❌ No (not allowed in PL/SQL) |

| Context                          | Overloading Allowed? |
| -------------------------------- | -------------------- |
| **Package spec/body**            | ✅ Yes                |
| **PL/SQL block (DECLARE/BEGIN)** | ❌ No                 |
| **Schema-level procedures**      | ✅ Yes                |
| **Triggers**                     | ❌ Not applicable     |

```
------ Declare in a Package

CREATE OR REPLACE PACKAGE math_utils IS
  FUNCTION add(x NUMBER, y NUMBER) RETURN NUMBER;
  FUNCTION add(x NUMBER, y NUMBER, z NUMBER) RETURN NUMBER;
  FUNCTION add(x VARCHAR2, y VARCHAR2) RETURN VARCHAR2;
END math_utils;

------ Package Body

CREATE OR REPLACE PACKAGE BODY math_utils IS

  -- Add two numbers
  FUNCTION add(x NUMBER, y NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN x + y;
  END;

  -- Add three numbers
  FUNCTION add(x NUMBER, y NUMBER, z NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN x + y + z;
  END;

  -- Concatenate two strings
  FUNCTION add(x VARCHAR2, y VARCHAR2) RETURN VARCHAR2 IS
  BEGIN
    RETURN x || y;
  END;

END math_utils;

-------- Usage

DECLARE
  v_result1 NUMBER;
  v_result2 NUMBER;
  v_result3 VARCHAR2(100);
BEGIN
  v_result1 := math_utils.add(5, 10);         -- Calls 2-number version
  v_result2 := math_utils.add(5, 10, 15);     -- Calls 3-number version
  v_result3 := math_utils.add('Hello, ', 'Alex'); -- Calls string version

  DBMS_OUTPUT.PUT_LINE(v_result1);  -- 15
  DBMS_OUTPUT.PUT_LINE(v_result2);  -- 30
  DBMS_OUTPUT.PUT_LINE(v_result3);  -- Hello, Alex
END;
```
