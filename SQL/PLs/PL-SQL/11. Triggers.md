# Triggers

A trigger is a named PL/SQL block that automatically executes when a specified DML, DDL, or system event occurs on a table, view, or database.

âœ… Triggers can:
- Enforce business rules at the DB level
- Automatically populate fields (e.g., timestamps)
- Audit changes (e.g., track old & new values)
- Prevent unauthorized changes
- Enable updatable views

## Types of Triggers
| ðŸ—‚ **Category**        | ðŸ“„ **Event**                 | ðŸ”· **Scope/Use Case**                   |
| ---------------------- | ---------------------------- | --------------------------------------- |
| **DML Trigger**        | `INSERT`, `UPDATE`, `DELETE` | Tables or views; enforce business rules |
| **Instead-of Trigger** | `INSERT`, `UPDATE`, `DELETE` | Views; make views updatable             |
| **DDL Trigger**        | `CREATE`, `DROP`, `ALTER`    | Audit schema changes                    |
| **Database Trigger**   | `LOGON`, `LOGOFF`, etc.      | Session or database-wide actions        |
| **Compound Trigger**   | `INSERT`, `UPDATE`, `DELETE` | Bulk DML; optimize row-by-row actions   |


### DML Triggers
These fire when DML statements (`INSERT`, `UPDATE`, `DELETE`) are executed on a table or view.

| ðŸ”· Type                        | Description              |
| ------------------------------ | ------------------------ |
| **BEFORE**                     | Before the DML operation |
| **AFTER**                      | After the DML operation  |
| **Row-level (`FOR EACH ROW`)** | Once per row affected    |
| **Statement-level**            | Once per SQL statement   |

Use for validations, default values, or audit details.

```
CREATE OR REPLACE TRIGGER trg_before_insert
BEFORE INSERT ON employees
FOR EACH ROW
BEGIN
  :NEW.created_at := SYSDATE;
END;
```

### Instead-of Trigger
Used only on views to make them updatable.

Views often span multiple tables, so Oracle canâ€™t figure out how to handle an INSERT, UPDATE, or DELETE â€” but INSTEAD OF lets you define the logic explicitly.

```
CREATE OR REPLACE TRIGGER trg_instead_of_insert
INSTEAD OF INSERT ON emp_view
FOR EACH ROW
BEGIN
  INSERT INTO employees(id, name) VALUES(:NEW.id, :NEW.name);
END;
```

### DDL Trigger (Data Definition)
Fires on schema-level or database-level DDL events like:
- `CREATE`
- `DROP`
- `ALTER`
- `RENAME`

```
CREATE OR REPLACE TRIGGER trg_ddl_audit
AFTER CREATE OR DROP OR ALTER
ON SCHEMA
BEGIN
  INSERT INTO ddl_log(event_time, user_name, ddl_type)
  VALUES(SYSDATE, USER, ORA_SYSEVENT);
END;
```

### Database Trigger
Fires on database-wide events, such as:
- LOGON
- LOGOFF
- STARTUP
- SHUTDOWN

```
CREATE OR REPLACE TRIGGER trg_logon
AFTER LOGON ON DATABASE
BEGIN
  INSERT INTO session_log(user_name, login_time)
  VALUES(USER, SYSDATE);
END;
```

### Compound Trigger
Designed for bulk operations, to improve performance and avoid context switching between SQL and PL/SQL.

ets you write all timing points (`BEFORE STATEMENT`, `BEFORE EACH ROW`, `AFTER EACH ROW`, `AFTER STATEMENT`) in one trigger.

```
CREATE OR REPLACE TRIGGER trg_compound
FOR UPDATE ON employees
COMPOUND TRIGGER

  v_count NUMBER := 0;

  BEFORE STATEMENT IS
  BEGIN
    v_count := 0;
  END BEFORE STATEMENT;

  AFTER EACH ROW IS
  BEGIN
    v_count := v_count + 1;
  END AFTER EACH ROW;

  AFTER STATEMENT IS
  BEGIN
    DBMS_OUTPUT.PUT_LINE('Total rows updated: ' || v_count);
  END AFTER STATEMENT;

END;
```
